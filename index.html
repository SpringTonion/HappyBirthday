<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Happy Birthday</title>
<style>
    * { box-sizing: border-box; }
    body, html {
        margin: 0; padding: 0; width: 100%; height: 100vh;
        background: #ffffff; overflow: hidden;
        font-family: 'Segoe UI', sans-serif;
        transition: background 0.8s ease; /* Nền chuyển màu mượt hơn */
    }

    body.dark-mode { background: #1a0a20; } /* Tím sẫm khi tắt đèn */

    #main-canvas {
        position: relative; width: 100%; height: 100%;
        display: flex; justify-content: center; align-items: center;
    }

    /* ================= HỘP QUÀ ================= */
    .box-container {
        position: relative; width: 300px; height: 300px;
        cursor: pointer; z-index: 100;
        transition: opacity 0.8s, transform 0.8s;
    }
    .box-base, .box-lid { width: 100%; position: absolute; }
    .box-lid { top: 0; transition: transform 1.2s cubic-bezier(0.4, 0, 0.2, 1); z-index: 2; }
    .box-base { bottom: 0; z-index: 1; }
    .open .box-lid { transform: translateY(-180px) rotate(-15deg); }
    .fade-out { opacity: 0; pointer-events: none; }

    /* ================= VẬT PHẨM (Upscale & Closer) ================= */
    #surprise {
        position: absolute; display: flex;
        justify-content: center; align-items: flex-end;
        gap: 5px; /* Các món quà sát nhau hơn */
        width: 100%; height: 100%;
        pointer-events: none;
    }

    .item {
        opacity: 0; transform: scale(0);
        transition: opacity 0.8s, transform 0.8s cubic-bezier(0.17, 0.67, 0.46, 1.2);
        cursor: pointer; pointer-events: auto;
        position: relative;
    }

    .ensure-root { width: 120px; margin-bottom: 100px; } /* Đã upscale */
    .cake-container { width: 280px; margin-bottom: 80px; } /* Đã upscale */
    .card-root { width: 150px; margin-bottom: 100px; } /* Đã upscale */

    /* ================= NẾN TRÊN BÁNH ================= */
    .candle-wrapper {
        position: absolute;
        top: 10%; /* Chỉnh nến cao hay thấp so với bánh ở đây */
        left: 50%;
        transform: translateX(-50%);
        z-index: 5;
        cursor: pointer;
        display: none;
    }
    
    .flame {
        width: 18px; height: 25px; background: #ff9800;
        border-radius: 50% 50% 20% 20%;
        margin: 0 auto; display: none;
        box-shadow: 0 0 30px #ff5722, 0 0 60px #ff9800;
        animation: flicker 0.2s infinite alternate;
    }
    
    @keyframes flicker { 
        from { transform: scale(1) rotate(-1deg); opacity: 0.9; } 
        to { transform: scale(1.1) rotate(1deg); opacity: 1; } 
    }

    .candle-stick {
        width: 8px; height: 35px; 
        background: linear-gradient(to bottom, #fff, #ddd);
        margin: 0 auto; border-radius: 2px;
    }

    /* ================= OVERLAY THIỆP (Smooth Pop-up) ================= */
    #overlay {
        position: fixed; inset: 0; 
        background: rgba(20, 0, 30, 0.9);
        display: none; justify-content: center; align-items: center;
        z-index: 1000; opacity: 0;
        transition: opacity 0.6s ease;
        backdrop-filter: blur(10px);
    }

    #overlay.active { opacity: 1; display: flex; }

    .card-content { 
        color: white; text-align: center; padding: 40px;
        max-width: 600px; width: 85%;
        transform: scale(0.7); opacity: 0;
        transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    #overlay.active .card-content { transform: scale(1); opacity: 1; }

    .card-content h1 { font-size: 2.5rem; color: #ffd700; }
    .card-content p { font-size: 1.2rem; line-height: 1.8; overflow-y: auto; max-height: 50vh; }

    .spawned-ensure { position: absolute; width: 80px; z-index: 5; pointer-events: none; }

    @media(max-width: 600px) {
        .cake-container { width: 180px; }
        .ensure-root { width: 70px; }
        .card-root { width: 90px; }
    }
</style>
</head>
<body onclick="handleGlobalClick(event)">

<div id="main-canvas">
    <div class="box-container" id="box" onclick="openBox(event)">
        <img src="box-lid.png" class="box-lid">
        <img src="box-base.png" class="box-base">
    </div>

    <div id="surprise">
        <img src="ensure.png" id="ensure-root" class="item ensure-root" onclick="spawnEnsure(event)">

        <div id="cake-root" class="item cake-container">
            <div class="candle-wrapper" id="candle" onclick="lightCandle(event)">
                <div class="flame" id="flame"></div>
                <div class="candle-stick"></div>
            </div>
            <img src="cake.png" style="width: 100%;">
        </div>

        <img src="card.png" id="card-root" class="item card-root" onclick="openCard(event)">
    </div>
</div>

<div id="overlay" onclick="closeCard()">
    <div class="card-content">
        <h1>Happy Birthday! ✨</h1>
        <p>Chúc bạn tuổi mới luôn rạng rỡ, tràn đầy niềm vui và gặt hái được nhiều thành công trong cuộc sống!</p>
        <p>Mong rằng mọi điều tốt đẹp nhất sẽ đến với bạn. Hãy luôn mỉm cười và hạnh phúc nhé!</p>
        <button onclick="closeCard()" style="padding: 12px 30px; cursor: pointer; border-radius: 20px; border:none; margin-top:20px; background: gold; font-weight:bold;">Đóng</button>
    </div>
</div>

<audio id="music" src="music.mp3" loop></audio>

<script>
    const box = document.getElementById('box');
    const music = document.getElementById('music');
    const candle = document.getElementById('candle');
    const flame = document.getElementById('flame');
    const overlay = document.getElementById('overlay');

    function openBox(e) {
        e.stopPropagation();
        box.classList.add('open');
        music.play();
        
        setTimeout(() => {
            document.querySelectorAll('.item').forEach(item => {
                item.style.opacity = "1";
                item.style.transform = "scale(1)";
            });
            candle.style.display = "block";
        }, 800);

        setTimeout(() => box.classList.add('fade-out'), 1600);
    }

    function spawnEnsure(e) {
        e.stopPropagation();
        const newEnsure = document.createElement('img');
        newEnsure.src = 'ensure.png';
        newEnsure.className = 'spawned-ensure';
        
        let x, y, collision;
        let attempts = 0;
        do {
            collision = false;
            x = Math.random() * (window.innerWidth - 80);
            y = Math.random() * (window.innerHeight - 100);
            const rects = [...document.querySelectorAll('.item, .spawned-ensure, .box-container')].map(el => el.getBoundingClientRect());
            for (let rect of rects) {
                if (!(x + 80 < rect.left || x > rect.right || y + 100 < rect.top || y > rect.bottom)) {
                    collision = true; break;
                }
            }
            attempts++;
        } while (collision && attempts < 100);

        newEnsure.style.left = x + 'px';
        newEnsure.style.top = y + 'px';
        document.body.appendChild(newEnsure);
    }

    function lightCandle(e) {
        e.stopPropagation();
        document.body.classList.add('dark-mode');
        flame.style.display = 'block';
    }

    function handleGlobalClick(e) {
        // Tắt nến nếu đang trong chế độ tối
        if (document.body.classList.contains('dark-mode')) {
            document.body.classList.remove('dark-mode');
            flame.style.display = 'none';
        }
    }

    function openCard(e) {
        e.stopPropagation();
        overlay.style.display = 'flex';
        // Delay một chút để hiệu ứng transition hoạt động
        setTimeout(() => overlay.classList.add('active'), 10);
    }

    function closeCard() {
        overlay.classList.remove('active');
        setTimeout(() => overlay.style.display = 'none', 600);
    }
</script>
</body>
</html>
