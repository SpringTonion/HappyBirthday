<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="format-detection" content="telephone=no">
<title>Happy Birthday‚ú®</title>
<style>
    * { box-sizing: border-box; }
    body, html {
        margin: 0; padding: 0; width: 100%; height: 100vh;
        background: #ffffff; overflow: hidden;
        font-family: 'Segoe UI', sans-serif;
        transition: background 0.8s ease;
    }

    body.dark-mode { background: #2D0341; }

    #main-canvas {
        position: relative; width: 100%; height: 100%;
        display: flex; justify-content: center; align-items: center;
    }

    /*GIFT BOX*/
    .box-container {
        position: absolute; width: 280px; height: 280px;
        cursor: pointer; z-index: 100;
        transition: opacity 1s ease, transform 1s ease;
    }
    .box-base, .box-lid { width: 100%; position: absolute; left: 0; }
    .box-lid { top: 15px; transition: transform 1.2s cubic-bezier(0.4, 0, 0.2, 1); z-index: 2; }
    .box-base { bottom: 0; z-index: 1; }
    .open .box-lid { transform: translateY(-220px) rotate(-10deg); }
    .fade-out { opacity: 0; transform: scale(0.8); pointer-events: none; }

    /*NOW PLAYING*/
    #now-playing {
        position: fixed; top: 15px; left: 15px; z-index: 1000; background: rgba(0, 0, 0, 0.4); color: white;
        padding: 8px 15px; border-radius: 20px;
        font-size: 14px;
        backdrop-filter: blur(5px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        pointer-events: none;
        display: none;
        transition: opacity 0.5s;
        cursor: pointer; 
        pointer-events: auto; 
        transition: 0.3s ease;
        user-select: none;
        max-width: 300px; 
        overflow: hidden;
        white-space: nowrap;
    }

    .music-info-container {
        display: flex;
        overflow: hidden;
        width: 100%;
        margin-left: 5px;
    }

    .music-info-container.is-scrolling {
        mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
        -webkit-mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
    }

    #song-name {
        display: inline-block;
        will-change: transform;
    }

    #now-playing:hover {
        background: rgba(0, 0, 0, 0.6);
        transform: scale(1.05);
    }   

    .marquee {
        display: inline-block;
        animation: marquee 8s linear infinite;
        padding-right: 67px;
    }

    @keyframes marquee {
        0% { transform: translateX(0); }
        100% { transform: translateX(-50%); }
    }

    #mute-btn {
        position: fixed; top: 15px; right: 15px; z-index: 1001;
        background: rgba(0, 0, 0, 0.5); color: white;
        width: 38px; height: 38px; border-radius: 50%;
        display: none; justify-content: center; align-items: center;
        cursor: pointer; border: 1px solid rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(5px);
        transition: all 0.3s;
    }

    #mute-btn:hover { transform: scale(1.1); background: rgba(0, 0, 0, 0.7); }

    #surprise {
        position: absolute; display: flex;
        justify-content: center; align-items: flex-end;
        gap: 15px; z-index: 50; pointer-events: none;
    }

    .item, .spawned-ensure {
        opacity: 0; transform: scale(0) translateY(50px);
        transition: opacity 1s ease, transform 1s cubic-bezier(0.34, 1.56, 0.64, 1);
        cursor: pointer; pointer-events: auto;
    }

    .ensure-root { width: 180px; margin-bottom: 30px; }
    .cake-container { width: 280px; position: relative; display: flex; justify-content: center; }
    .card-root { width: 200px; margin-bottom: 30px; }

    /*CANDLE*/
    .candle-wrapper {
        position: absolute;
        bottom: 65%; left: 50%; transform: translateX(-50%);
        width: 15%; z-index: 60; cursor: pointer; display: none;
    }
    .candle-img { width: 100%; height: auto; position: relative; z-index: 61; }
    .flame-img {
        position: absolute; left: 50%; transform: translateX(-50%);
        bottom: 80%; width: 110%; height: auto; z-index: 62; 
        display: none; filter: drop-shadow(0 0 15px #ff9800);
        animation: flicker 0.2s infinite alternate;
    }
    body.dark-mode .flame-img, body.dark-mode .candle-glow { display: block !important; }
    @keyframes flicker { 
        from { transform: translateX(-50%) scale(1); } 
        to { transform: translateX(-50%) scale(1.1); } 
    }
    .candle-glow {
        position: absolute;
        bottom: 100%; 
        left: 50%; 
        transform: translate(-50%, 50%);
        width: 300px; 
        height: 300px; 
        background: radial-gradient(circle, rgba(255,165,0,0.5) 0%, rgba(255,165,0,0) 70%);
        border-radius: 50%; 
        filter: blur(15px); 
        z-index: 59; 
        display: none;
        pointer-events: none; 
    }
    .candle-touch-area { position: absolute; top: -40px; bottom: -20px; left: -25px; right: -25px; z-index: 65; }

    /*ENSURE RANDOM*/
    @keyframes popUpRandom {
        0% { transform: translate(0, 0) scale(0) rotate(0deg); opacity: 0; }
        70% { transform: translate(var(--tw-x), var(--tw-y)) scale(calc(var(--tw-s) * 1.1)) rotate(var(--tw-r)); opacity: 1; }
        100% { transform: translate(var(--tw-x), var(--tw-y)) scale(var(--tw-s)) rotate(var(--tw-r)); opacity: 1; }
    }
    .spawned-ensure {
        position: absolute; width: 80px; z-index: 5; pointer-events: none;
    }

    /*THI·ªÜP CH√öC*/
    #overlay {
        position: fixed; inset: 0; background: rgba(20, 5, 30, 0.8);
        display: none; justify-content: center; align-items: center;
        z-index: 2000; opacity: 0; transition: opacity 0.8s ease;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
    }
    #overlay.active { opacity: 1; display: flex; }
    .card-content { 
        color: white; text-align: center; padding: 30px;
        max-width: 550px; width: 90%; transform: scale(0.5); opacity: 0;
        transition: all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
        background: rgba(255, 255, 255, 0.05); border-radius: 20px;
        border: 1px solid rgba(118, 222, 66, 0.3);
    }

    .tap-to-close {
        margin-top: 25px;
        font-size: 0.9rem;
        color: #76DE42;
        opacity: 0.8;
        font-style: italic;
    }
    
    #overlay.active .card-content { transform: scale(1); opacity: 1; }

    @media(max-width: 600px) {
        .cake-container { width: 180px; }
        .ensure-root { width: 80px; }
        .card-root { width: 90px; }
        .box-container { width: 220px; height: 220px; }
    }

    /*WISHES CONTAINER*/
    .wishes-container {
        flex: 1;
        max-height: 65vh;
        overflow-y: auto;
        overflow-x: hidden;
        padding: 10px 15px;
        margin-top: 15px;
        text-align: left; 
        word-wrap: break-word;
        overflow-wrap: break-word;
    }

    .wishes-container::-webkit-scrollbar { width: 4px; }
    .wishes-container::-webkit-scrollbar-thumb { background: #E0D1B0(255, 215, 0, 0.3); border-radius: 10px; }

    .wish-box {
        background: rgba(255, 255, 255, 0.08);
        padding: 20px;
        border-radius: 15px;
        margin-bottom: 20px;
        border-left: 4px solid #76de42;
    }

    .wish-text {
        font-size: 1.1rem;
        line-height: 1.6;
        margin-bottom: 10px;
        color: #f0f0f0;
        white-space: pre-line;
    }

    .sender-name {
        text-align: right;
        font-weight: bold;
        color: #76de42;
        font-style: italic;
        display: block;
    }

    .close-hint {
        margin-top: 20px;
        font-size: 0.9rem;
        opacity: 0.5;
        text-align: center;
    }
    /*ENSURE GOLD*/
    .gold-glow {
        filter: drop-shadow(0 0 10px rgb(255, 238, 142)) brightness(1.0);
    }

    #clear-btn {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 1000;
        background: rgba(194, 194, 194, 0.2);
        color: #2D0341;
        border: 1px solid #2D0341;
        padding: 8px 15px;
        border-radius: 15px;
        cursor: pointer;
        display: none; 
        backdrop-filter: blur(5px);
        font-weight: bold;
        transition: 0.3s;
    }
    #clear-btn:hover {
        background: #3b0455;
        color: #ffffff;
    }

</style>
</head>
<body onclick="handleGlobalClick(event)">

<div id="main-canvas">
    <div class="box-container" id="box" onclick="openBox(event)">
        <img src="box-lid.png" class="box-lid">
        <img src="box-base.png" class="box-base">
    </div>
    
    <div id="surprise">
        <img src="ensure.png" id="ensure-root" class="item ensure-root" onclick="spawnEnsure(event)">
        <div id="cake-root" class="item cake-container">
            <div class="candle-wrapper" id="candle" onclick="lightCandle(event)">
                <div class="candle-touch-area"></div>
                <img src="flame.png" class="flame-img">
                <div class="candle-glow"></div>
                <img src="candle.png" class="candle-img">
            </div>
            <img src="cake.png" style="width: 100%;">
        </div>
        <img src="card.png" id="card-root" class="item card-root" onclick="openCard(event)">
    </div>
</div>

<div id="overlay" onclick="closeCard()">
    <div class="card-content" onclick="event.stopPropagation()"> 
        <h1 style="color: #76DE42; font-size: 2.2rem; margin-bottom: 10px;">Happy Birthday</h1>
        
        <div class="wishes-container">
            <div class="wish-box">
                <div class="wish-text">Ch√∫c m·ª´ng sinh nh·∫≠t Puri/Ria/PƒÉn/P∆∞n/Ph∆∞∆°ng/Naphuong/Naph/PAN/ P∆∞∆°ng/M√®o/Fel/P whatever. Ch√∫c c·∫≠u lu√¥n tuy·ªát v·ªùi v√† ng√†y c√†ng tuy·ªát v·ªùi h∆°n nh√©, ng∆∞·ªùi m·ªì c√¥i cha m·∫°nh nh·∫•t m√¨nh bi·∫øt &gt;&lt;</div>
                <span class="sender-name">‚Äî tui ƒë√≥ hello</span>
            </div>

            <div class="wish-box">
                <div class="wish-text">ch√∫c ti·ªÅn v√†o nh∆∞ n∆∞·ªõc s·ªëng l√¢u trƒÉm tu·ªïi ƒë·ª£i tui v√¥ sg chung vui v·ªõi</div>
                <span class="sender-name">‚Äî Eli</span>
            </div>

            <div class="wish-box">
                <div class="wish-text">tui ch√∫c P sinh nh·∫≠t tu·ªïi m·ªõi h·∫°nh ph√∫c v√† ƒë·ªùi g·∫∑p nhi·ªÅu thu·∫≠n l·ª£i nka</div>
                <span class="sender-name">‚Äî PTN</span>
            </div>

           <div class="wish-box">
                <div class="wish-text">Happy womb escape day üòé</div>
                <span class="sender-name">‚Äî M√¨</span>
            </div>

            <div class="wish-box">
                <div class="wish-text">Ch√∫c em b√© hay ƒÉn ch√≥ng l·ªõn ƒÉn kh·ªèe s·ªëng l√¢u chim to b·∫•t t·ª≠</div>
                <span class="sender-name">‚Äî Linh/Pu</span>
            </div>

            <div class="wish-box">
                <div class="wish-text">ChuÃÅc meÃÄo sinh nh√¢Ã£t th√¢Ã£t EliLuchi :3 ChuÃÅc b√¥ÃÅ meÃÄo s∆°ÃÅm h√¥ÃÄi sinh gia t√¥Ã£c</div>
                <span class="sender-name">‚Äî cnhs</span>
            </div>

            <div class="wish-box">
                <div class="wish-text">e vas ch√∫c m√®o b√©o sinh nh·∫≠t vui v·∫ª h·∫°nh ph√∫c, qua tu·ªïi m·ªõi mong m√®o c√≥ ƒë∆∞·ª£c nh·ªØng g√¨ t·ªët ƒë·∫πp nh·∫•t nh·∫•t nh·∫•t. em v√° m·∫øn m√®o kh√¥ng k·ªÉ sao ƒë∆∞·ª£c cho h·∫øt</div>
                <span class="sender-name">‚Äî V√°</span>
            </div>

            <div class="wish-box">
                <div class="wish-text">Ch√∫c M√®l tu·ªïi m·ªõi g·∫∑p nhi·ªÅu may m·∫Øn sigma, C√ì NHI·ªÄU S·ª®C KH·ªéE. H·ªØu duy√™n mcyt angst eliluchi ohio v√† ƒÇN NHI·ªÄU VAO√í!!!!!!!!!!!!!! :3333333333333</div>
                <span class="sender-name">‚Äî B√¥ng</span>
            </div>

            <div class="wish-box">
                <div class="wish-text">Nah r·∫•t vui v√¨ c√≥ Mel l√† 1 ph·∫ßn c·ªßa CnB, ch√∫c m·ª´ng sinh nh·∫≠t, c·∫ßu cho m·ªçi may m·∫Øn ti·ªÅn t√†i t·ªõi v·ªõi Mel nh√©.</div>
                <span class="sender-name">‚Äî Nah</span>
            </div>

            <div class="wish-box">
                <div class="wish-text">M·ª´ng em sinh nh·∫≠t vui v·∫ª nha ü•∫ C·ªè m·ªõi bi·∫øt nhi·ªÅu v·ªÅ em h∆°n c√°ch ƒë√¢y kh√¥ng l√¢u d√π m√¨nh add t·ª´ t√°m ho√°nh r·ªìi, nh∆∞ng thi·ªát s·ª± c·ªè r·∫•t m·ª´ng v√¨ em ƒë√£ nch v·ªõi c·ªè √°. D√π ch·ªâ m·ªõi quen th√¢n h∆°n ƒë∆∞·ª£c 1 kho·∫£ng ng·∫Øn nh∆∞ng c·ªè nh·∫≠n ra ƒë∆∞·ª£c em l√† m·ªôt ng∆∞·ªùi v√¥ c√πng ho·∫°t b√°t, em c≈©ng r·∫•t hay trong vi·ªác ch·ªß ƒë·ªông t√¨m ki·∫øm b·∫°n b√® v√† l√†m th√¢n, v√† c≈©ng l√† 1 ng∆∞·ªùi b·∫°n si√™u d·ªÖ th∆∞∆°ng lu√¥n...b·∫±ng ch·ª©ng d·ªÖ th·∫•y nh·∫•t l√† vi·ªác em d·ªÖ th∆∞∆°ng nh∆∞ n√†o th√¨ b·∫°n em s·∫Ω nh∆∞ th·∫ø, t·∫°i n·∫øu ƒë√≥ k ph·∫£i s·ª± th·∫≠t th√¨ em c≈©ng kh√¥ng nh·∫≠n ƒë∆∞·ª£c l·ªùi nh·∫Øn n√†y ƒë√¢u √°. Tr·ª´ vi·ªác ƒë√≥ th√¨ qua qu√° tr√¨nh n√≥i chuy·ªán v·ªõi em th√¨ c·ªè c≈©ng th·∫•y ƒë∆∞·ª£c s·ª± nhi·ªát huy·∫øt c·ªßa em, c·ªè c≈©ng si√™u ng∆∞·ª°ng m·ªô c√°i n√†y...Mong em kh√¥ng bao gi·ªù m·∫•t ƒëi ng·ªçn l·ª≠a ƒë√≥ n√®.
                    
                    Ch√∫c em m·ªçi ng√†y ƒë·ªÅu thi·ªát thi·ªát tuy·ªát v·ªùi, v√† c·ª© ng∆∞·ªõc ƒë·∫ßu nh√¨n tr·ªùi ti·∫øp ƒëi em.  </div>
                <span class="sender-name">‚Äî C·ªè</span>
            </div>

            <div class="wish-box">
                <div class="wish-text">Hello em, Ch√∫c m·ª´ng sinh nh·∫≠t vui v·∫ª nh√©. Tao th√¨ kh√¥ng c√≥ v√≤ng vo, v√¥ th·∫≥ng lu√¥n, tao ch√∫c m√†y tu·ªïi m·ªõi tr√†n ƒë·∫ßy ni·ªÅm vui, v√† cu·ªôc s·ªëng c≈©ng nh·∫π nh√†ng v·ªõi m√†y h∆°n. M√†y l√† ng∆∞·ªùi t·ªët P ·∫°, ch·ªâ l√† m√†y kh√¥ng th·∫•y r√µ vi·ªác ƒë√≥ cho l·∫Øm, m√† ng∆∞·ªùi t·ªët th√¨ x·ª©ng ƒë√°ng ƒë∆∞·ª£c c√≥ k·∫øt c·ª•c t·ªët ƒë·∫πp m√†? Ch√∫c m√†y t√¨m ƒë∆∞·ª£c b·∫øn ƒë·ªó tinh th·∫ßn, ng∆∞·ªùi cho m√†y t√¨nh y√™u nh∆∞ m√†y trao cho h·ªç, ch·ª© tao th·∫•y m√†y c·∫ßn l·∫Øm r·ªìi ƒë·∫•y c·ª•c c∆∞ng. Tao nghƒ© m√†y x·ª©ng ƒë√°ng v·ªõi ƒëi·ªÅu ƒë√≥ m√†, nh·∫•t l√† khi m√†y ·ªü ƒë√≥ cho m·ªçi ng∆∞·ªùi. √Ä, ch√∫c m√†y c√≥ nhi·ªÅu ti·ªÅn n·ªØa nh√© ƒë·ªÉ tr·∫£ n·ª£ cho tbm (ƒë√πa th) (ch·∫Øc v) v√¨ m√†y c√≥ nƒÉng l·ª±c m√†, c·ªë l√™n, r·ªìi m·ªôt ng√†y nh·∫≠n comm Vgen 5 c·ªß, h√¨ h√¨.

                    Ch√∫c em vui v·∫ª nh√©, iu e</div>
                <span class="sender-name">‚Äî Tu·ªôc</span>
            </div>

            <div class="wish-box">
                <div class="wish-text">Ch√∫c p tu·ªïi m·ªõi m√£i ƒë·∫πp, m√£i vui. G·∫∑p nhi·ªÅu ng∆∞·ªùi t·ªët, ƒë·∫πp t√≠nh, khi·∫øn p vui v·∫ª h∆°n. Bu√¥n b√°n ƒë·∫Øt nh∆∞ t√¥m, tranh v·∫Ω lu√¥n amazing.</div>
                <span class="sender-name">‚Äî Ng√¥</span>
            </div>

            <div class="wish-box">
                <div class="wish-text">Ch√∫c M√®o sinh nh·∫≠t vui v·∫ª, h√£y tho·∫£i m√°i l√†m ƒëi·ªÅu m√¨nh th√≠ch, ch√∫c m mau v∆∞·ª£t qua ƒë∆∞·ª£c nh·ªØng kh√≥ khƒÉn trong cu·ªôc s·ªëng. Anh em b·∫°n b√® lu√¥n ·ªü b√™n m, y√™u th∆∞∆°ng v√† ·ªßng h·ªô m ü´∂</div>
                <span class="sender-name">‚Äî Moshii</span>
            </div>
        
            <div class="wish-box">
                <div class="wish-text">tui ch√∫c m√®o mau ƒÉn ch√≥ng l·ªõn</div>
                <span class="sender-name">‚Äî L√≤</span>
            </div>
            
            <div class="wish-box">
                <div class="wish-text">even if we haven't known each other for long, february 16th had already became an especial date to me.
i've told you a thousand times before, but i never imagined meeting someone like you. like, ever. and i'm so thankful i did, because my 2025 and 2026 until now would have been the same the same without you.
youuu, riaaaa, such a funny, talented, loving and authentic person. üíó
i can't and will never stop getting amazed by your art, giggling at your remarks, and being surprised the more you let me know you. which i hope can continue for much longer!
i hope you have a great day, a great year, AND A GREAT LIFE, because you truly deserve it.
no matter what, don't forget how much i loooove you!! and how especial you areee!!!!!!! üíñüíóüíûüíñüíû
happy birthday, ria  üéâ‚ú® </div>
                <span class="sender-name">‚Äî Valentine</span>
            </div>

            <div class="wish-box">
                <div class="wish-text">Ch√∫c m·ª´ng sinh nh·∫≠t M√®o gong xi pha g√≥t ü¶∂ü¶∂ü¶∂ Tu·ªïi m·ªõi new you new yaoi üî• Ch√∫c M√®o ng√†y sinh nh·∫≠t v√† nh·ªØng ng√†y sau ƒë√≥ vui v·∫ª. Mong nh·ªØng ƒëi·ªÅu t·ªët ƒë·∫πp s·∫Ω ƒë·∫øn v·ªõi M√®o v√† √≠t phi·ªÅn b·∫≠n v·ªõi nh·ªØng b·∫•t tr·∫Øc trong cu·ªôc s·ªëng (v√† ƒë·ª´ng ƒë·ªÉ b·ªã m·∫•y th kh·ªëi vu√¥ng queerbait nh∆∞ t)üê™ Ch√∫c M√®o l√†m ƒÉn bu√¥n may b√°n ƒë·∫Øt ti·ªÅn v·ªõi yaoi v√¥ √†o √†o ƒë·ªÉ s·ª•c yaoi v√† mua ensure v√† nu√¥i tui :3333 gi·ªù th√¨ hop on idv rank th√¥i bro</div>
                <span class="sender-name">‚Äî Th∆∞</span>
            </div>
            
        </div>

            <div class="tap-to-close" onclick="closeCard()">(Tap anywhere else to close)</div>    
    </div>
</div>
<button id="clear-btn" onclick="clearEnsures(event)">Nu·ªët h·∫øt Ensure</button>
<div id="mute-btn" onclick="toggleMute(event)">üîä</div>
<audio id="ensure-sound" src="click_sound.mp3"></audio> 
<audio id="music"></audio>
<div id="now-playing" onclick="changeSongManual(event)"><span style="white-space: nowrap; flex-shrink: 0; opacity: 0.8;">Now playing:</span><div class="music-info-container">
        <span id="song-name">...</span>
    </div>
</div>

<script>
    const playlist = [
        { name: "Home Again - Park Lane ft. LaKesha Nugent", src: "music1.mp3" },
        { name: "Microdose - Jackson Laird", src: "music2.mp3" },
        { name: "dog cuddles - dad sports", src: "music3.mp3" },
        { name: "For You - Troy Javelona", src: "music4.mp3" },
        { name: "Killer Tune Kills Me - KIRINJI ft. YonYon", src: "music5.mp3" },
        { name: "I WANTED YOU TO FEEL IT - phendste", src: "music6.mp3" },
    ];
        let currentPlaylist = [];
        let currentSongIndex = 0;
        let lastPlayedSrc = "";
        const music = document.getElementById('music');
        const muteBtn = document.getElementById('mute-btn');
        const nowPlayingDiv = document.getElementById('now-playing');
        const nameEl = document.getElementById('song-name');
        const infoContainer = document.querySelector('.music-info-container');

        function shufflePlaylist() {
            let newShuffle;
            do {
                newShuffle = [...playlist].sort(() => Math.random() - 0.5);
            } while (newShuffle.length > 1 && newShuffle[0].src === lastPlayedSrc);
            currentPlaylist = newShuffle;
        }

        function playNextSong() {
            if (currentPlaylist.length === 0) return;
            if (currentSongIndex >= currentPlaylist.length) {
                currentSongIndex = 0;
                shufflePlaylist();
            }
            const song = currentPlaylist[currentSongIndex];
            lastPlayedSrc = song.src;
            music.src = song.src;
            music.volume = 0.1627;
            document.getElementById('song-name').innerText = song.name;
            
            nameEl.innerText = song.name;
            nameEl.classList.remove('marquee');
            infoContainer.classList.remove('is-scrolling');
            nameEl.style.animation = "none"; 
            nameEl.style.transform = "translateX(0)";
            setTimeout(() => {
                if (nameEl.offsetWidth > infoContainer.offsetWidth) {
                    nameEl.innerText = song.name + "\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0" + song.name + "\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0";
                    setTimeout(() => {
                        nameEl.classList.add('spotify-marquee');
                        infoContainer.classList.add('is-scrolling');
                        nameEl.style.animation = "marquee 8s linear infinite";
                    }, 3000); 
                }
            }, 200);
            music.play().catch(() => {});
            currentSongIndex++;
        }

        function changeSongManual(e) {
            if (e) e.stopPropagation(); 
            playNextSong();
        }

        function toggleMute(e) {
            if (e) e.stopPropagation();
            music.muted = !music.muted;
            document.getElementById('ensure-sound').muted = music.muted;
            muteBtn.innerText = music.muted ? "üîá" : "üîä";
        }

        music.onended = playNextSong;

    const box = document.getElementById('box');
    const candle = document.getElementById('candle');
    const overlay = document.getElementById('overlay');
    const surpriseItems = document.querySelectorAll('.item');
    
    let isCardOpen = false;
    let exitLock = false;
    let isBoxOpened = false;
    
    function openBox(e) {
        if (isBoxOpened) return;
        e.stopPropagation();
        isBoxOpened = true;
        box.classList.add('open');
        shufflePlaylist();
        playNextSong();
 
        nowPlayingDiv.style.display = 'flex';
        muteBtn.style.display = 'flex';

        setTimeout(() => box.classList.add('fade-out'), 1500);
        setTimeout(() => {
            surpriseItems.forEach(item => {
                item.style.opacity = "1";
                item.style.transform = "scale(1) translateY(0)";
            });
            candle.style.display = "block";
        }, 1800); 
        setTimeout(() => box.style.display = "none", 3000);
    }

    let ensureCount = 0;

    function spawnEnsure(e) {
        e.stopPropagation();
        ensureCount++;
        if (ensureCount % 10 === 0 && ensureCount > 0) {
            document.getElementById('clear-btn').style.display = 'block';
        }
        const sound = document.getElementById('ensure-sound');
        sound.currentTime = 0; 
        sound.play();
        const img = document.createElement('img');
        img.src = 'ensure.png';
        img.className = 'spawned-ensure';
        const isGold = Math.random() < 0.05; 
        if (isGold) {
            img.src = 'ensure_gold.png';
            img.classList.add('gold-glow');
        } else {
            img.src = 'ensure.png';
        }
        
        const randomRotate = Math.floor(Math.random() * 80 - 40); 
        const randomScale = (Math.random() * 0.6 + 0.7).toFixed(2); 
        
        let x, y, collision;
        let attempts = 0;
        const padding = 20; 
        do {
            collision = false;
            x = Math.random() * (window.innerWidth - 100);
            y = Math.random() * (window.innerHeight - 120);
            
            const rects = [...document.querySelectorAll('.item, .spawned-ensure, .box-container')].map(el => el.getBoundingClientRect());
            for (let rect of rects) {
                if (!(x + 80 + padding < rect.left || x - padding > rect.right || 
                      y + 110 + padding < rect.top || y - padding > rect.bottom)) {
                    collision = true; 
                    break;
                }
            }
            attempts++;
        } while (collision && attempts < 150);

        img.style.left = x + 'px';
        img.style.top = y + 'px';
        img.style.setProperty('--tw-r', randomRotate + 'deg');
        img.style.setProperty('--tw-s', randomScale);
        img.style.setProperty('--tw-x', '0px');
        img.style.setProperty('--tw-y', '0px');
        
        img.style.animation = "popUpRandom 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards";
        
        document.body.appendChild(img);
    }

    function clearEnsures(e) {
        if (e) e.stopPropagation();
        const ensures = document.querySelectorAll('.spawned-ensure');
        ensures.forEach(el => el.remove());
        ensureCount = 0;
        document.getElementById('clear-btn').style.display = 'none';
    }

    function lightCandle(e) {
        e.stopPropagation();
        document.body.classList.add('dark-mode');
    }

    function handleGlobalClick(e) {
        if (document.body.classList.contains('dark-mode')) {
            document.body.classList.remove('dark-mode');
        }
    }

    function openCard(e) {
        if (isCardOpen) return; 
        e.stopPropagation();
        isCardOpen = true;
        overlay.style.display = 'flex';
        setTimeout(() => overlay.classList.add('active'), 50);
    }

    function closeCard() {
        if (exitLock) return;
        overlay.classList.remove('active');
        setTimeout(() => {
            overlay.style.display = 'none';
            isCardOpen = false; 
        }, 800);
    }
</script>
</body>
</html>




